# Ops Team Access Scenario ‚Äì IAM Permissions

---

## Scenario Overview

We have an Ops team with **10 members**.  
All team members are mapped to the same permission group, which provides **full access to EC2 and S3**.

Recently, a new team member named **Sunil** joined the Ops team.

- Sunil is **very experienced with EC2**
- He **does not have experience with S3**
- He is a **contract employee**

Our S3 buckets contain many objects, including **confidential information**.  
For security reasons, we do **not want Sunil to have access to S3**, even though he is mapped to the Ops team.

---

## ‚úÖ Requirement

**Sunil should have only EC2 access and no S3 access**,  
even though the Ops team has permissions for both EC2 and S3.

---

## ‚ùì Question

Is it possible to **remove or restrict S3 access for Sunil only**,  
while keeping EC2 access, even though he is part of the Ops team?

---

## ‚úçÔ∏è Important Point

When we check **AWS managed policies**, there is **no policy available to deny S3 access**.

AWS does **not provide a default S3 deny policy**,  
so we need to create a **custom IAM policy** to explicitly deny S3 access.

---

## üîµ In AWS IAM ‚Äì Policies

---

## üõ†Ô∏è Steps to Create S3 Deny Policy

1. Go to **IAM ‚Üí Policies**
2. Click **Create policy**
3. Choose a service ‚Üí search for **S3**
4. Under **Effect**, select **Deny**
5. In **Actions**
   - Choose **Manual actions**
   - Select **All S3 actions**
6. In **Resources**, select **All resources**
7. Click **Next**
8. Enter:
   - **Policy Name:** `S3-deny`
   - **Description:** This policy will deny all S3 operations
9. Click **Create policy**

---

## ‚ö†Ô∏è Important Note

Creating the policy **does not automatically attach it**  
to any user or group.

---

## üõ†Ô∏è Steps to Attach Policy to Sunil

1. Go to **IAM ‚Üí Users**
2. Select **Sunil**
3. Click **Add permissions**
4. Choose **Attach policies directly**
5. Search for **S3-deny**
6. Attach the policy

---

## üìå IAM Concept / Rule

**Deny always has the highest priority in AWS IAM.**

For a user or group, if a service has both **Allow** and **Deny** permissions  
(for example: S3, EC2, VPC, RDS, IAM, etc.):

- ‚úÖ **Deny overrides all Allow permissions**
- Even if permissions are given at:
  - Group level
  - User level
  - Administrator level

Once **Deny** is applied, access is blocked.

---

## üîµ Use Case

---

## üßæ Explanation

Sometimes we may receive a ticket like:

> ‚ÄúI have full access to an S3 bucket, but I am not able to upload an object.‚Äù

In such cases, we must check whether a **Deny permission** is assigned to the user.

---

## üîç Verification Steps

- Open the **Sunil** user in IAM
- He has:
  - EC2‚ÄìS3 full access (via group)
  - `S3-deny` policy (directly attached)
- Because of the **S3-deny** policy:
  - Sunil **cannot access S3**
- The deny policy is attached at the **user level**, not group level
- Log in using Sunil‚Äôs credentials in another browser
- Attempt to access S3 ‚Üí ‚ùå **Access denied**

---

## üü¢ Final Conclusion

- **Deny has the highest priority** over Allow
- Even if **AdministratorAccess** is granted,
  **Sunil will still not be able to access S3**


# **BLUE pen ‚Äì Heading / Topic**
## Restricting S3 Access for Krishna User

---

# **BLACK pen ‚Äì Steps / Scenario**
- Login to Krishna user. He is from the DevOps team, so he currently has Admin access.
- Check whether he can access S3.
- Krishna joined recently as a fresher, and we want to restrict S3 access because it contains confidential information.
- We maintain customer data, and any data loss will need to be tracked. Therefore, we must restrict Krishna‚Äôs access to the S3 bucket.

---

# **GREEN pen ‚Äì Key Question & Answer**
**Question:** Is it possible to restrict Krishna‚Äôs access to S3?  
**Answer:** Yes, it is possible.

---

# **BLACK pen ‚Äì Steps / Solution**
- We already have the `S3-deny` policy.
- Go to **Users**, open Krishna user, and **Add permission ‚Üí Attach policies directly**.
- Attach `S3-deny` policy.
- Check if Krishna can access S3 now.  
  **Result:** He will not be able to access S3.

---

# **GREEN pen ‚Äì Important Observation / Security Note**
- Krishna was working on a ticket and needed S3 access.  
  Since he had Admin access, he removed the S3-deny policy temporarily, completed his work, and then re-attached the policy.
- This action will appear in the audit trail logs, which is a different case, but it still shows a potential security leakage.

---

# **LIGHT BLUE pen ‚Äì Lesson / Best Practice**
**Best Practice:**  
- When providing any permission, avoid giving Admin access.  
- Always follow **least privilege principle** to prevent this type of security issue.

---

# **BLACK pen ‚Äì Restricting IAM Access**
**Steps to restrict IAM access for Krishna:**
1. Go to **Policies ‚Üí Create policy**
2. Choose **Service:** IAM
3. **Effect:** Deny
4. **Manual actions:** Select All
5. **Resources:** All
6. Click **Next**
7. **Policy Name:** IAM-deny
8. **Description:** (Optional)
9. Attach this policy to Krishna user
10. Login as Krishna and check access

- Once we create a policy, we can use it for n number of users, groups, and roles.

---

# **GREEN pen ‚Äì Important Note / Closing**
- There will be different use cases, and we need to check permissions based on requirements each time.

